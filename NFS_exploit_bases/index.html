<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://cyber-puit-de-connaissances.com/NFS_exploit_bases/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>NFS - Cyber-puit de connaissances</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "NFS";
        var mkdocs_page_input_path = "NFS_exploit_bases.md";
        var mkdocs_page_url = "/NFS_exploit_bases/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Cyber-puit de connaissances
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../accueil/">Accueil</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Utile</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../ecoute_ports.md">Ecoute de ports</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sites_utiles/">Les sites utiles</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reconnaissance</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../reconnaissance_passive/">Reconnaissance Passive</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Nmap</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../nmap_bases_scan/">Les scans</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../nmap_bases_utiles/">Utile</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Exploits</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Metasploit</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_bases/">Les bases</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_exploits/">Les exploits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_msfvenom/">Les shells</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_meterpreter/">Les post-exploits</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Autres outils</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Hydra</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../hydra_bases/">Les bases</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Wireshark</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../wireshark_bases/">Les bases</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Nessus</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../nessus_bases/">Les bases</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Les protocoles</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../SMB_exploit_bases/">SMB</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TELNET_exploit_bases/">TELNET</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../FTP_exploit_bases/">FTP</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">NFS</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fonctionnement-succinct-du-protocole-nfs">Fonctionnement succinct du protocole NFS</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#enumeration">Enumeration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#packet-necessaire">Packet nécessaire</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ports-de-base-nfs">Ports de base NFS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#enumeration-des-partages-nfs">Enumération des partages NFS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#montage-dun-partage-nfs">Montage d'un partage NFS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#demontage-dun-partage-nfs">Démontage d'un partage NFS</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exploitation-dun-partage-nfs">Exploitation d'un partage NFS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#gains-de-privileges">Gains de privilèges</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#exploitation-de-luid">Exploitation de l'UID</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SSH_exploit_bases/">SSH</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SMTP_exploit_bases/">SMTP</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Web</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../web_exploit_bases/">Les bases</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Wifi</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../wifi-cracking/">Wifi mdp cracking</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Autre services</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../MySQL_exploit_bases/">MySQL</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Les OS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../vide/">Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Linux</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../linux_commandes_utiles/">Commandes utiles</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Réseau</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../changer_DNS_windows/">Changer DNS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Système</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">BIOS</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="#">Accès au hardware</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../reset_mdp_BIOS_hardware_PC_fixe/">PC fixe</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../reset_mdp_BIOS_hardware_PC_portable/">PC portable</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Cyber-puit de connaissances</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Les protocoles &raquo;</li>
      <li class="breadcrumb-item active">NFS</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="les-bases-des-exploits-nfs">Les bases des exploits NFS</h1>
<h2 id="introduction">Introduction</h2>
<p>Le protocole NFS (Network File System) est un protocole de partage de fichiers qui permet aux utilisateurs de se connecter à un serveur et d'accéder à des fichiers distants comme s'ils étaient stockés localement. Il est utilisé pour partager des fichiers, des répertoires et des périphériques sur un réseau. Il est basé sur le protocole RPC (Remote Procedure Call) et utilise le protocole TCP/IP pour la communication entre les machines. Il permet à un système de partager des répertoires et des fichiers avec d'autres sur un réseau. En utilisant NFS, les utilisateurs et les programmes peuvent accéder à des fichiers sur des systèmes distants presque comme s'il s'agissait de fichiers locaux. Pour ce faire, il monte tout ou partie d'un système de fichiers sur un serveur. Les clients peuvent accéder à la partie du système de fichiers qui est montée avec les privilèges attribués à chaque fichier.</p>
<p>Le protocole NFS permet de transférer des fichiers entre des ordinateurs fonctionnant sous Windows et d'autres systèmes d'exploitation non Windows, tels que Linux, MacOS ou UNIX.</p>
<p>Un ordinateur fonctionnant sous Windows Server peut faire office de serveur de fichiers NFS pour d'autres ordinateurs clients ne fonctionnant pas sous Windows. De même, NFS permet à un ordinateur Windows fonctionnant sous Windows Server d'accéder à des fichiers stockés sur un serveur NFS non Windows.</p>
<h3 id="fonctionnement-succinct-du-protocole-nfs">Fonctionnement succinct du protocole NFS</h3>
<p>Tout d'abord, le client demande à monter un répertoire d'un hôte distant sur un répertoire local, de la même manière qu'il peut monter un périphérique physique. Le service de montage se connecte alors au démon de montage correspondant à l'aide de RPC.</p>
<p>Le serveur vérifie si l'utilisateur a le droit de monter le répertoire demandé. Il renvoie ensuite une poignée de fichier qui identifie de manière unique chaque fichier et répertoire se trouvant sur le serveur.</p>
<p>Si quelqu'un souhaite accéder à un fichier à l'aide de NFS, un appel RPC est lancé à NFSD (le démon NFS) sur le serveur. Cet appel prend des paramètres tels que :</p>
<ul>
<li>l'identifiant du fichier</li>
<li>le nom du fichier auquel il faut accéder</li>
<li>l'ID de l'utilisateur</li>
<li>l'ID du groupe de l'utilisateur</li>
</ul>
<p>Ces éléments sont utilisés pour déterminer les droits d'accès au fichier spécifié. C'est ce qui contrôle les autorisations de l'utilisateur, c'est-à-dire la lecture et l'écriture des fichiers.</p>
<h2 id="enumeration">Enumeration</h2>
<h3 id="packet-necessaire">Packet nécessaire</h3>
<p>Tout d'abord, il faut avoir le paquet nfs-common installé sur la machine. Pour cela, il suffit de rentrer la commande suivante :</p>
<pre><code class="language-bash">sudo apt install nfs-common
</code></pre>
<h3 id="ports-de-base-nfs">Ports de base NFS</h3>
<p>Le port de base NFS est le port 2049. C'est du TCP/IP.</p>
<h3 id="enumeration-des-partages-nfs">Enumération des partages NFS</h3>
<p>Pour lister les partages NFS, il suffit de rentrer la commande suivante :</p>
<pre><code class="language-bash">showmount -e [IP]
</code></pre>
<h3 id="montage-dun-partage-nfs">Montage d'un partage NFS</h3>
<p>Le client a besoin d'un point de montage local pour accéder au système de fichiers NFS partagé. Le point de montage peut être un répertoire vide ou un répertoire existant avec des fichiers. Le client peut monter le système de fichiers NFS partagé sur un point de montage local à l'aide de la commande mount.</p>
<pre><code class="language-bash">sudo mount -t nfs [IP]:[PATH] [PATH] -nolock
</code></pre>
<table>
<thead>
<tr>
<th>TAG</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-t nfs</code></td>
<td>spécifie le type de système de fichiers</td>
</tr>
<tr>
<td><code>[IP]:[PATH]</code></td>
<td>spécifie l'adresse IP du serveur NFS et le chemin d'accès au partage NFS</td>
</tr>
<tr>
<td><code>[PATH]</code></td>
<td>spécifie le chemin d'accès au point de montage local</td>
</tr>
<tr>
<td><code>-nolock</code></td>
<td>Spécifie de ne pas utiliser le verrouillage NLM</td>
</tr>
</tbody>
</table>
<h3 id="demontage-dun-partage-nfs">Démontage d'un partage NFS</h3>
<p>Pour démonter un partage NFS, il suffit de rentrer la commande suivante :</p>
<pre><code class="language-bash">sudo umount [PATH]
</code></pre>
<h2 id="exploitation-dun-partage-nfs">Exploitation d'un partage NFS</h2>
<h3 id="gains-de-privileges">Gains de privilèges</h3>
<h4 id="exploitation-de-luid">Exploitation de l'UID</h4>
<p>Prérequis : avoir réussi à se connecter en SSH sur la machine cible</p>
<p>Si le serveur NFS est configuré pour utiliser des UID statiques, il est possible de créer un utilisateur avec un UID bas et de se connecter en tant que cet utilisateur pour obtenir des privilèges plus élevés.</p>
<p>Méthode : </p>
<ol>
<li>Se connecter en tant qu'utilisateur avec un UID bas</li>
<li>Téléchargement de l'exécutable Bash sur le partage NFS</li>
<li>Définir les permissions SUID via NFS en raison d'une mauvaise configuration de la racine Squash</li>
<li>Connexion par SSH</li>
<li>Exécuter l'exécutable SUID Bit Bash</li>
<li>ROOT ACCESS</li>
</ol>
<p>La cible étant un serveur Ubuntu Server 18.04 nous utiliserons un exécutable bash standard d'Ubuntu, le même que celui du serveur (le type de serveur a été su grâce à notre analyse nmap).
Lexécutable est disponible sur ce <a href="https://github.com/polo-sec/writing/tree/master">github</a>
Attention à ne télécharger que l'exécutable voulu : bash
L'exécutable : </p>
<pre><code class="language-bash">wget https://github.com/polo-sec/writing/raw/master/Security%20Challenge%20Walkthroughs/Networks%202/bash
</code></pre>
<p>Il faut changer les permission de l'exécutable en lui rajoutant le bit SUID :</p>
<pre><code class="language-bash">chmod +s bash
</code></pre>
<p>Il faut aussi lui ajouter les droits d'exécution s'il ne l'a pas : </p>
<pre><code class="language-bash">chmod +x bash
</code></pre>
<p>Les droits du fichier devraient ressembler à ça :</p>
<pre><code class="language-bash">-rwsr-sr-x 1 root root 1.3M Apr  4  2018 bash
</code></pre>
<p>Il faut le mettre dans le répertoire monté en nfs et se connecter en SSH sur la machine cible.
Enfin, il suffit de l'exécuter avec :</p>
<pre><code class="language-bash">./bash -p
</code></pre>
<p>Le flag -p permet de garder les droits de l'utilisateur actuel, ce qui permet d'obtenir un shell root.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../FTP_exploit_bases/" class="btn btn-neutral float-left" title="FTP"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../SSH_exploit_bases/" class="btn btn-neutral float-right" title="SSH">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../FTP_exploit_bases/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../SSH_exploit_bases/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
