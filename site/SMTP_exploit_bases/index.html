<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://cyber-puit-de-connaissances.com/SMTP_exploit_bases/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>SMTP - Cyber-puit de connaissances</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "SMTP";
        var mkdocs_page_input_path = "SMTP_exploit_bases.md";
        var mkdocs_page_url = "/SMTP_exploit_bases/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Cyber-puit de connaissances
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../accueil/">Accueil</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Utile</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ecoute_ports/">Ecoute de ports</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sites_utiles/">Les sites utiles</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Outils</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Nmap</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../nmap_bases_scan/">Les scans</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../nmap_bases_utiles/">Utile</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Metasploit</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_bases/">Les bases</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_exploits/">Les exploits</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_msfvenom/">Les shells</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metasploit_meterpreter/">Les post-exploits</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Hydra</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../hydra_bases/">Les bases</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Wireshark</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../wireshark_bases/">Les bases</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Exploits</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Les protocoles</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../SMB_exploit_bases/">SMB</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TELNET_exploit_bases/">TELNET</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FTP_exploit_bases/">FTP</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../NFS_exploit_bases/">NFS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SSH_exploit_bases/">SSH</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">SMTP</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#fonctionnement-succinct-du-protocole-smtp">Fonctionnement succinct du protocole SMTP</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#enumeration">Enumeration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ports-de-base-smtp">Ports de base SMTP</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#packet-necessaire">Packet nécessaire</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#commandes-internes-smtp">Commandes internes SMTP</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#enumeration-de-smtp">Enumération de SMTP</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exploitation">Exploitation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#bruteforce-dun-utilisateur">Bruteforce d'un utilisateur</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Autre services</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../MySQL_exploit_bases/">MySQL</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Les OS</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../vide/">Windows</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../vide/">Linux</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Réseau</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../changer_DNS_windows/">Changer DNS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Système</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">BIOS</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="#">Accès au hardware</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../reset_mdp_BIOS_hardware_PC_fixe/">PC fixe</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../reset_mdp_BIOS_hardware_PC_portable/">PC portable</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Cyber-puit de connaissances</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Exploits &raquo;</li>
          <li>Les protocoles &raquo;</li>
      <li>SMTP</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="smtp-les-bases">SMTP : les bases</h1>
<h2 id="introduction">Introduction</h2>
<p>Le protocole SMTP (Simple Mail Transfer Protocol) est un protocole de communication utilisé pour transférer des messages électroniques entre des serveurs de messagerie. Il est utilisé pour envoyer des messages électroniques à partir d'un client de messagerie vers un serveur de messagerie et d'un serveur de messagerie vers un autre. Il est également utilisé pour transférer des messages électroniques entre différents serveurs de messagerie.</p>
<h3 id="fonctionnement-succinct-du-protocole-smtp">Fonctionnement succinct du protocole SMTP</h3>
<ol>
<li>L'agent utilisateur de messagerie, qui est soit votre client de messagerie, soit un programme externe, se connecte au serveur SMTP de votre domaine, par exemple smtp.google.com. Ceci initie la poignée de main SMTP. Cette connexion fonctionne sur le port SMTP - qui est généralement 25. Une fois ces connexions établies et validées, la session SMTP démarre.</li>
<li>Le processus d'envoi du courrier peut maintenant commencer. Le client soumet d'abord au serveur l'adresse électronique de l'expéditeur et du destinataire, le corps du message et les éventuelles pièces jointes.</li>
<li>Le serveur SMTP vérifie ensuite si le nom de domaine du destinataire et celui de l'expéditeur sont identiques.</li>
<li>Le serveur SMTP de l'expéditeur établit une connexion avec le serveur SMTP du destinataire avant de relayer le courrier électronique. Si le serveur du destinataire n'est pas accessible ou n'est pas disponible, l'e-mail est placé dans une file d'attente SMTP.</li>
<li>Ensuite, le serveur SMTP du destinataire vérifie le courriel entrant. Pour ce faire, il vérifie si le domaine et le nom d'utilisateur ont été reconnus. Le serveur transfère ensuite le courriel au serveur POP ou IMAP, comme le montre le schéma ci-dessus.</li>
<li>Le message s'affichera alors dans la boîte de réception du destinataire.</li>
</ol>
<p>Il s'agit d'une version très simplifiée du processus, et de nombreux sous-protocoles, communications et détails n'ont pas été inclus. Si vous souhaitez en savoir plus sur ce sujet, il s'agit d'une description très conviviale des détails techniques les plus fins - je l'ai d'ailleurs utilisée pour écrire cette description : <a href="https://computer.howstuffworks.com/e-mail-messaging/email3.htm">How SMTP works</a></p>
<h2 id="enumeration">Enumeration</h2>
<h3 id="ports-de-base-smtp">Ports de base SMTP</h3>
<p>Le port de base SMTP est le port 25. C'est du TCP/IP.</p>
<h3 id="packet-necessaire">Packet nécessaire</h3>
<p>Des serveurs de messagerie mal configurés ou vulnérables peuvent souvent constituer un point d'ancrage initial dans un réseau, mais avant de lancer une attaque, nous voulons prendre l'empreinte du serveur afin de rendre notre ciblage aussi précis que possible. Pour ce faire, nous allons utiliser le module <strong>smtp_version</strong> de <strong>MetaSploit</strong>. Comme son nom l'indique, il analysera une plage d'adresses IP et déterminera la version de tous les serveurs de messagerie qu'il rencontrera.</p>
<p>Il est intéressant de noter que cette technique d'énumération fonctionnera pour la majorité des configurations SMTP ; cependant, il existe d'autres outils <strong>non-metasploit</strong> tels que <strong>smtp-user-enum</strong> qui fonctionnent encore mieux pour énumérer les comptes utilisateurs au niveau du système d'exploitation sur Solaris via le service SMTP. L'énumération est réalisée en inspectant les réponses aux commandes VRFY, EXPN, et RCPT TO.</p>
<h3 id="commandes-internes-smtp">Commandes internes SMTP</h3>
<p>Le service SMTP dispose de deux commandes internes qui permettent d'énumérer les utilisateurs : <strong>VRFY</strong> (qui confirme les noms des utilisateurs valides) et <strong>EXPN</strong> (qui révèle l'adresse réelle des alias et des listes de courrier électronique de l'utilisateur (listes de diffusion). En utilisant ces commandes SMTP, nous pouvons révéler une liste d'utilisateurs valides</p>
<h3 id="enumeration-de-smtp">Enumération de SMTP</h3>
<p>Nous pouvons le faire manuellement, via une connexion telnet, mais Metasploit vient à nouveau à la rescousse, en fournissant un module pratique appelé <strong>smtp_enum</strong> qui fera le travail à notre place ! Pour utiliser le module, il suffit de lui fournir un hôte ou une plage d'hôtes à analyser et une liste de mots contenant des noms d'utilisateurs à énumérer.</p>
<p>Pour la wordlist à utiliser pour tester les utilisateurs, nous pouvons utiliser la wordlist <strong>/usr/share/wordlists/metasploit/unix_users.txt</strong> qui contient une liste de noms d'utilisateurs courants.
Mais j'ai utilisé seclist : <a href="https://github.com/danielmiessler/SecLists">seclist github</a></p>
<pre><code class="language-bash">msf6 &gt; use auxiliary/scanner/smtp/smtp_enum
msf6 auxiliary(scanner/smtp/smtp_enum) &gt; set RHOSTS [ip]
RHOSTS =&gt; [ip]
msf6 auxiliary(scanner/smtp/smtp_enum) &gt; set USER_FILE /usr/share/seclist/Usernames/top-usernames-shortlist.txt
USER_FILE =&gt; /usr/share/seclist/Usernames/top-usernames-shortlist.txt
msf6 auxiliary(scanner/smtp/smtp_enum) &gt; run
</code></pre>
<h2 id="exploitation">Exploitation</h2>
<h3 id="bruteforce-dun-utilisateur">Bruteforce d'un utilisateur</h3>
<p>Une fois qu'on a obtenu l'id d'un utilisateur, si un port SSH ou autre est ouvert sur la machine, on peut essayer de le bruteforce avec Hydra par exemple.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../SSH_exploit_bases/" class="btn btn-neutral float-left" title="SSH"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../MySQL_exploit_bases/" class="btn btn-neutral float-right" title="MySQL">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../SSH_exploit_bases/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../MySQL_exploit_bases/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
